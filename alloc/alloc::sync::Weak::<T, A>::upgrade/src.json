{
  "name": "alloc::sync::Weak::<T, A>::upgrade",
  "span": "$library/alloc/src/sync.rs:3250:5: 3252:18",
  "src": "pub fn upgrade(&self) -> Option<Arc<T, A>>\n    where\n        A: Clone,\n    {\n        #[inline]\n        fn checked_increment(n: usize) -> Option<usize> {\n            // Any write of 0 we can observe leaves the field in permanently zero state.\n            if n == 0 {\n                return None;\n            }\n            // See comments in `Arc::clone` for why we do this (for `mem::forget`).\n            assert!(n <= MAX_REFCOUNT, \"{}\", INTERNAL_OVERFLOW_ERROR);\n            Some(n + 1)\n        }\n\n        // We use a CAS loop to increment the strong count instead of a\n        // fetch_add as this function should never take the reference count\n        // from zero to one.\n        //\n        // Relaxed is fine for the failure case because we don't have any expectations about the new state.\n        // Acquire is necessary for the success case to synchronise with `Arc::new_cyclic`, when the inner\n        // value can be initialized after `Weak` references have already been created. In that case, we\n        // expect to observe the fully initialized value.\n        if self.inner()?.strong.fetch_update(Acquire, Relaxed, checked_increment).is_ok() {\n            // SAFETY: pointer is not null, verified in checked_increment\n            unsafe { Some(Arc::from_inner_in(self.ptr, self.alloc.clone())) }\n        } else {\n            None\n        }\n    }"
}