{
  "name": "alloc::sync::Arc::<[T]>::from_iter_exact",
  "span": "$library/alloc/src/sync.rs:2274:5: 2274:85",
  "src": "unsafe fn from_iter_exact(iter: impl Iterator<Item = T>, len: usize) -> Arc<[T]> {\n        // Panic guard while cloning T elements.\n        // In the event of a panic, elements that have been written\n        // into the new ArcInner will be dropped, then the memory freed.\n        struct Guard<T> {\n            mem: NonNull<u8>,\n            elems: *mut T,\n            layout: Layout,\n            n_elems: usize,\n        }\n\n        impl<T> Drop for Guard<T> {\n            fn drop(&mut self) {\n                unsafe {\n                    let slice = from_raw_parts_mut(self.elems, self.n_elems);\n                    ptr::drop_in_place(slice);\n\n                    Global.deallocate(self.mem, self.layout);\n                }\n            }\n        }\n\n        unsafe {\n            let ptr = Self::allocate_for_slice(len);\n\n            let mem = ptr as *mut _ as *mut u8;\n            let layout = Layout::for_value_raw(ptr);\n\n            // Pointer to first element\n            let elems = (&raw mut (*ptr).data) as *mut T;\n\n            let mut guard = Guard { mem: NonNull::new_unchecked(mem), elems, layout, n_elems: 0 };\n\n            for (i, item) in iter.enumerate() {\n                ptr::write(elems.add(i), item);\n                guard.n_elems += 1;\n            }\n\n            // All clear. Forget the guard so it doesn't free the new ArcInner.\n            mem::forget(guard);\n\n            Self::from_ptr(ptr)\n        }\n    }"
}