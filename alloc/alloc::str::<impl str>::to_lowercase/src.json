{
  "name": "alloc::str::<impl str>::to_lowercase",
  "span": "$library/alloc/src/str.rs:380:5: 380:41",
  "src": "pub fn to_lowercase(&self) -> String {\n        let (mut s, rest) = convert_while_ascii(self, u8::to_ascii_lowercase);\n\n        let prefix_len = s.len();\n\n        for (i, c) in rest.char_indices() {\n            if c == 'Σ' {\n                // Σ maps to σ, except at the end of a word where it maps to ς.\n                // This is the only conditional (contextual) but language-independent mapping\n                // in `SpecialCasing.txt`,\n                // so hard-code it rather than have a generic \"condition\" mechanism.\n                // See https://github.com/rust-lang/rust/issues/26035\n                let sigma_lowercase = map_uppercase_sigma(self, prefix_len + i);\n                s.push(sigma_lowercase);\n            } else {\n                match conversions::to_lower(c) {\n                    [a, '\\0', _] => s.push(a),\n                    [a, b, '\\0'] => {\n                        s.push(a);\n                        s.push(b);\n                    }\n                    [a, b, c] => {\n                        s.push(a);\n                        s.push(b);\n                        s.push(c);\n                    }\n                }\n            }\n        }\n        return s;\n\n        fn map_uppercase_sigma(from: &str, i: usize) -> char {\n            // See https://www.unicode.org/versions/Unicode7.0.0/ch03.pdf#G33992\n            // for the definition of `Final_Sigma`.\n            debug_assert!('Σ'.len_utf8() == 2);\n            let is_word_final = case_ignorable_then_cased(from[..i].chars().rev())\n                && !case_ignorable_then_cased(from[i + 2..].chars());\n            if is_word_final { 'ς' } else { 'σ' }\n        }\n\n        fn case_ignorable_then_cased<I: Iterator<Item = char>>(iter: I) -> bool {\n            match iter.skip_while(|&c| c.is_case_ignorable()).next() {\n                Some(c) => c.is_cased(),\n                None => false,\n            }\n        }\n    }"
}