{
  "name": "alloc::collections::btree::append::<impl collections::btree::node::NodeRef<collections::btree::node::marker::Owned, K, V, collections::btree::node::marker::LeafOrInternal>>::bulk_push",
  "span": "$library/alloc/src/collections/btree/append.rs:39:5: 45:36",
  "src": "pub(super) fn bulk_push<I, A: Allocator + Clone>(\n        &mut self,\n        iter: I,\n        length: &mut usize,\n        alloc: A,\n    ) where\n        I: Iterator<Item = (K, V)>,\n    {\n        let mut cur_node = self.borrow_mut().last_leaf_edge().into_node();\n        // Iterate through all key-value pairs, pushing them into nodes at the right level.\n        for (key, value) in iter {\n            // Try to push key-value pair into the current leaf node.\n            if cur_node.len() < node::CAPACITY {\n                cur_node.push(key, value);\n            } else {\n                // No space left, go up and push there.\n                let mut open_node;\n                let mut test_node = cur_node.forget_type();\n                loop {\n                    match test_node.ascend() {\n                        Ok(parent) => {\n                            let parent = parent.into_node();\n                            if parent.len() < node::CAPACITY {\n                                // Found a node with space left, push here.\n                                open_node = parent;\n                                break;\n                            } else {\n                                // Go up again.\n                                test_node = parent.forget_type();\n                            }\n                        }\n                        Err(_) => {\n                            // We are at the top, create a new root node and push there.\n                            open_node = self.push_internal_level(alloc.clone());\n                            break;\n                        }\n                    }\n                }\n\n                // Push key-value pair and new right subtree.\n                let tree_height = open_node.height() - 1;\n                let mut right_tree = Root::new(alloc.clone());\n                for _ in 0..tree_height {\n                    right_tree.push_internal_level(alloc.clone());\n                }\n                open_node.push(key, value, right_tree);\n\n                // Go down to the rightmost leaf again.\n                cur_node = open_node.forget_type().last_leaf_edge().into_node();\n            }\n\n            // Increment length every iteration, to make sure the map drops\n            // the appended elements even if advancing the iterator panicks.\n            *length += 1;\n        }\n        self.fix_right_border_of_plentiful();\n    }"
}