{
  "name": "ostd::arch::iommu::dma_remapping::context_table::RootTable::specify_device_page_table",
  "span": "ostd/src/arch/x86/iommu/dma_remapping/context_table.rs:105:5: 109:6",
  "src": "pub(super) fn specify_device_page_table(\n        &mut self,\n        device_id: PciDeviceLocation,\n        page_table: PageTable<IommuPtConfig>,\n    ) {\n        let context_table = self.get_or_create_context_table(device_id);\n\n        let bus_entry = context_table\n            .entries_frame\n            .read_val::<ContextEntry>(\n                (device_id.device as usize * 8 + device_id.function as usize)\n                    * size_of::<ContextEntry>(),\n            )\n            .unwrap();\n\n        if bus_entry.is_present() {\n            panic!(\"existing device page tables should not be overridden\");\n        }\n\n        // Activate page table.\n        let address = page_table.root_paddr();\n        context_table.page_tables.insert(address, page_table);\n        let entry = ContextEntry(address as u128 | 1 | 0x1_0000_0000_0000_0000);\n        context_table\n            .entries_frame\n            .write_val::<ContextEntry>(\n                (device_id.device as usize * 8 + device_id.function as usize)\n                    * size_of::<ContextEntry>(),\n                &entry,\n            )\n            .unwrap();\n    }"
}