{
  "name": "ostd::mm::vm_space::VmSpace::activate",
  "span": "ostd/src/mm/vm_space.rs:125:5: 125:38",
  "src": "pub fn activate(self: &Arc<Self>) {\n        let preempt_guard = disable_preempt();\n        let cpu = preempt_guard.current_cpu();\n\n        let last_ptr = ACTIVATED_VM_SPACE.load();\n\n        if last_ptr == Arc::as_ptr(self) {\n            return;\n        }\n\n        // Record ourselves in the CPU set and the activated VM space pointer.\n        // `Acquire` to ensure the modification to the PT is visible by this CPU.\n        self.cpus.add(cpu, Ordering::Acquire);\n\n        let self_ptr = Arc::into_raw(Arc::clone(self)) as *mut VmSpace;\n        ACTIVATED_VM_SPACE.store(self_ptr);\n\n        if !last_ptr.is_null() {\n            // SAFETY: The pointer is cast from an `Arc` when it's activated\n            // the last time, so it can be restored and only restored once.\n            let last = unsafe { Arc::from_raw(last_ptr) };\n            last.cpus.remove(cpu, Ordering::Relaxed);\n        }\n\n        self.pt.activate();\n    }"
}