{
  "name": "ostd::mm::frame::meta::MetaSlot::get_from_in_use",
  "span": "ostd/src/mm/frame/meta.rs:268:5: 268:86",
  "src": "pub(super) fn get_from_in_use(paddr: Paddr) -> Result<*const Self, GetFrameError> {\n        let slot = get_slot(paddr)?;\n\n        // Try to increase the reference count for an in-use frame. Otherwise fail.\n        loop {\n            match slot.ref_count.load(Ordering::Relaxed) {\n                REF_COUNT_UNUSED => return Err(GetFrameError::Unused),\n                REF_COUNT_UNIQUE => return Err(GetFrameError::Unique),\n                0 => return Err(GetFrameError::Busy),\n                last_ref_cnt => {\n                    if last_ref_cnt >= REF_COUNT_MAX {\n                        // See `Self::inc_ref_count` for the explanation.\n                        abort();\n                    }\n                    // Using `Acquire` here to pair with `get_from_unused` or\n                    // `<Frame<M> as From<UniqueFrame<M>>>::from` (who must be\n                    // performed after writing the metadata).\n                    //\n                    // It ensures that the written metadata will be visible to us.\n                    if slot\n                        .ref_count\n                        .compare_exchange_weak(\n                            last_ref_cnt,\n                            last_ref_cnt + 1,\n                            Ordering::Acquire,\n                            Ordering::Relaxed,\n                        )\n                        .is_ok()\n                    {\n                        return Ok(slot as *const MetaSlot);\n                    }\n                }\n            }\n            core::hint::spin_loop();\n        }\n    }"
}