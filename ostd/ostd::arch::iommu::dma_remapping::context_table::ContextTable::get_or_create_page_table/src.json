{
  "name": "ostd::arch::iommu::dma_remapping::context_table::ContextTable::get_or_create_page_table",
  "span": "ostd/src/arch/x86/iommu/dma_remapping/context_table.rs:257:5: 260:39",
  "src": "fn get_or_create_page_table(\n        &mut self,\n        device: PciDeviceLocation,\n    ) -> &mut PageTable<IommuPtConfig> {\n        let bus_entry = self\n            .entries_frame\n            .read_val::<ContextEntry>(\n                (device.device as usize * 8 + device.function as usize) * size_of::<ContextEntry>(),\n            )\n            .unwrap();\n\n        if !bus_entry.is_present() {\n            let table = PageTable::<IommuPtConfig>::empty();\n            let address = table.root_paddr();\n            self.page_tables.insert(address, table);\n            let entry = ContextEntry(address as u128 | 3 | 0x1_0000_0000_0000_0000);\n            self.entries_frame\n                .write_val::<ContextEntry>(\n                    (device.device as usize * 8 + device.function as usize)\n                        * size_of::<ContextEntry>(),\n                    &entry,\n                )\n                .unwrap();\n            self.page_tables.get_mut(&address).unwrap()\n        } else {\n            self.page_tables\n                .get_mut(&(bus_entry.second_stage_pointer() as usize))\n                .unwrap()\n        }\n    }"
}