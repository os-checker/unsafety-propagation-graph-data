{
  "name": "ostd::arch::kernel::apic::x2apic::X2Apic::enable",
  "span": "ostd/src/arch/x86/kernel/apic/x2apic.rs:36:5: 36:36",
  "src": "pub(super) fn enable(&mut self) {\n        const X2APIC_ENABLE_BITS: u64 = {\n            // IA32_APIC_BASE MSR's EN bit: xAPIC global enable/disable\n            const EN_BIT_IDX: u8 = 11;\n            // IA32_APIC_BASE MSR's EXTD bit: Enable x2APIC mode\n            const EXTD_BIT_IDX: u8 = 10;\n\n            (1 << EN_BIT_IDX) | (1 << EXTD_BIT_IDX)\n        };\n\n        // SAFETY: These operations enable x2APIC, which is safe because `X2Apic` will only be\n        // constructed if x2APIC is known to be present.\n        unsafe {\n            // Enable x2APIC and xAPIC if they are not enabled by default.\n            let mut base = rdmsr(IA32_APIC_BASE);\n            if base & X2APIC_ENABLE_BITS != X2APIC_ENABLE_BITS {\n                base |= X2APIC_ENABLE_BITS;\n                wrmsr(IA32_APIC_BASE, base);\n            }\n\n            // Set SVR. Enable APIC and set Spurious Vector to 15 (reserved IRQ number).\n            let svr: u64 = (1 << 8) | 15;\n            wrmsr(IA32_X2APIC_SIVR, svr);\n        }\n    }"
}