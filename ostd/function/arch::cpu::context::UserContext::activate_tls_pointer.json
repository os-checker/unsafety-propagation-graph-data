{
  "name": "arch::cpu::context::UserContext::activate_tls_pointer",
  "safe": true,
  "callees": {
    "arch::cpu::context::UserContext::fsbase": {
      "safe": true,
      "tags": {
        "tags": [],
        "spec": {},
        "docs": []
      },
      "doc": "",
      "adt": {
        "arch::cpu::context::UserContext": "ImmutableAsArgument"
      }
    },
    "x86::bits64::segmentation::wrfsbase": {
      "safe": false,
      "tags": {
        "tags": [],
        "spec": {},
        "docs": []
      },
      "doc": " Write FS Segment Base\n\n # Safety\n Needs FSGSBASE-Enable Bit (bit 16 of CR4) set.\n",
      "adt": {}
    }
  },
  "adts": {
    "arch::cpu::context::UserContext": [
      "Ref"
    ]
  },
  "path": 315,
  "span": "ostd/src/arch/x86/cpu/context/mod.rs:254:5: 260:6",
  "src": "pub fn activate_tls_pointer(&self) {\n        // In x86, context switching preserves `fsbase`, but `fsbase` won't be loaded at\n        // `UserContext::execute`, so it must be activated in advance.\n        //\n        // SAFETY: Setting `fsbase` won't affect kernel code.\n        unsafe { wrfsbase(self.fsbase() as u64) }\n    }",
  "mir": "fn arch::cpu::context::UserContext::activate_tls_pointer(_1: &arch::cpu::context::UserContext) -> () {\n    let mut _0: ();\n    let mut _2: u64;\n    let mut _3: usize;\n    debug self => _1;\n    bb0: {\n        StorageLive(_2);\n        StorageLive(_3);\n        _3 = arch::cpu::context::UserContext::fsbase(_1) -> [return: bb1, unwind unreachable];\n    }\n    bb1: {\n        _2 = move _3 as u64;\n        StorageDead(_3);\n        _0 = x86::bits64::segmentation::wrfsbase(move _2) -> [return: bb2, unwind unreachable];\n    }\n    bb2: {\n        StorageDead(_2);\n        return;\n    }\n}\n",
  "doc": " Activates the thread-local storage pointer for the current task.\n\n The method by itself is safe because the value of the TLS register won't affect kernel code.\n But if the user program relies on the TLS pointer, make sure that the pointer is correctly\n set when entering the user space.\n",
  "tags": {
    "tags": [],
    "spec": {},
    "docs": []
  }
}