{
  "name": "ostd::arch::late_init_on_bsp",
  "span": "ostd/src/arch/x86/mod.rs:62:1: 62:40",
  "src": "pub(crate) unsafe fn late_init_on_bsp() {\n    // SAFETY: This is only called once on this BSP in the boot context.\n    unsafe { trap::init_on_cpu() };\n\n    // SAFETY: The caller ensures that this function is only called once on BSP,\n    // after the kernel page table is activated.\n    let io_mem_builder = unsafe { io::construct_io_mem_allocator_builder() };\n\n    kernel::apic::init(&io_mem_builder).expect(\"APIC doesn't exist\");\n    irq::chip::init(&io_mem_builder);\n    irq::ipi::init();\n\n    kernel::tsc::init_tsc_freq();\n    timer::init_on_bsp();\n\n    // SAFETY: We're on the BSP and we're ready to boot all APs.\n    unsafe { crate::boot::smp::boot_all_aps() };\n\n    if_tdx_enabled!({\n    } else {\n        match iommu::init(&io_mem_builder) {\n            Ok(_) => {}\n            Err(err) => log::warn!(\"IOMMU initialization error:{:?}\", err),\n        }\n    });\n\n    // SAFETY:\n    // 1. All the system device memory have been removed from the builder.\n    // 2. All the port I/O regions belonging to the system device are defined using the macros.\n    // 3. `MAX_IO_PORT` defined in `crate::arch::io` is the maximum value specified by x86-64.\n    unsafe { crate::io::init(io_mem_builder) };\n\n    kernel::acpi::init();\n    power::init();\n}"
}