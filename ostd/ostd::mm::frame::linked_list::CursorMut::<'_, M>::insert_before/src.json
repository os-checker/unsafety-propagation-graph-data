{
  "name": "ostd::mm::frame::linked_list::CursorMut::<'_, M>::insert_before",
  "span": "ostd/src/mm/frame/linked_list.rs:332:5: 332:69",
  "src": "pub fn insert_before(&mut self, mut frame: UniqueFrame<Link<M>>) {\n        // The frame can't possibly be in any linked lists since the list will\n        // own the frame so there can't be any unique pointers to it.\n        debug_assert!(frame.meta_mut().next.is_none());\n        debug_assert!(frame.meta_mut().prev.is_none());\n        debug_assert_eq!(frame.slot().in_list.load(Ordering::Relaxed), 0);\n\n        let frame_ptr = NonNull::from(frame.meta_mut());\n\n        if let Some(current) = &mut self.current {\n            // SAFETY: We own the current node by `&mut self` and the node is\n            // initialized.\n            let current_mut = unsafe { current.as_mut() };\n\n            if let Some(prev) = &mut current_mut.prev {\n                // SAFETY: We own the previous node by `&mut self` and the node\n                // is initialized.\n                let prev_mut = unsafe { prev.as_mut() };\n\n                debug_assert_eq!(prev_mut.next, Some(*current));\n                prev_mut.next = Some(frame_ptr);\n\n                frame.meta_mut().prev = Some(*prev);\n                frame.meta_mut().next = Some(*current);\n                *prev = frame_ptr;\n            } else {\n                debug_assert_eq!(self.list.front, Some(*current));\n                frame.meta_mut().next = Some(*current);\n                current_mut.prev = Some(frame_ptr);\n                self.list.front = Some(frame_ptr);\n            }\n        } else {\n            // We are at the \"ghost\" non-element.\n            if let Some(back) = &mut self.list.back {\n                // SAFETY: We have ownership of the links via `&mut self`.\n                unsafe {\n                    debug_assert!(back.as_mut().next.is_none());\n                    back.as_mut().next = Some(frame_ptr);\n                }\n                frame.meta_mut().prev = Some(*back);\n                self.list.back = Some(frame_ptr);\n            } else {\n                debug_assert_eq!(self.list.front, None);\n                self.list.front = Some(frame_ptr);\n                self.list.back = Some(frame_ptr);\n            }\n        }\n\n        frame\n            .slot()\n            .in_list\n            .store(self.list.lazy_get_id(), Ordering::Relaxed);\n\n        // Forget the frame to transfer the ownership to the list.\n        let _ = frame.into_raw();\n\n        self.list.size += 1;\n    }"
}