{
  "name": "ostd::arch::iommu::dma_remapping::context_table::ContextTable::map",
  "span": "ostd/src/arch/x86/iommu/dma_remapping/context_table.rs:291:5: 296:39",
  "src": "unsafe fn map(\n        &mut self,\n        device: PciDeviceLocation,\n        daddr: Daddr,\n        paddr: Paddr,\n    ) -> Result<(), ContextTableError> {\n        if device.device >= 32 || device.function >= 8 {\n            return Err(ContextTableError::InvalidDeviceId);\n        }\n\n        trace!(\n            \"Mapping Daddr: {:x?} to Paddr: {:x?} for device: {:x?}\",\n            daddr, paddr, device\n        );\n\n        let from = daddr..daddr + PAGE_SIZE;\n        let prop = PageProperty {\n            flags: PageFlags::RW,\n            cache: CachePolicy::Uncacheable,\n            priv_flags: PrivFlags::empty(),\n        };\n\n        let pt = self.get_or_create_page_table(device);\n        let preempt_guard = disable_preempt();\n        let mut cursor = pt.cursor_mut(&preempt_guard, &from).unwrap();\n\n        // SAFETY: The safety is upheld by the caller.\n        unsafe { cursor.map((paddr, 1, prop)).unwrap() };\n\n        Ok(())\n    }"
}