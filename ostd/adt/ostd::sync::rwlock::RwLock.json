{
  "name": "ostd::sync::rwlock::RwLock",
  "constructors": [
    "ostd::sync::rwlock::RwLock::<T, G>::new"
  ],
  "access_self_as_arg": {
    "read": [
      "ostd::sync::rwlock::RwLock::<T, G>::read",
      "ostd::sync::rwlock::RwLock::<T, G>::write",
      "ostd::sync::rwlock::RwLock::<T, G>::upread",
      "ostd::sync::rwlock::RwLock::<T, G>::try_read",
      "ostd::sync::rwlock::RwLock::<T, G>::try_write",
      "ostd::sync::rwlock::RwLock::<T, G>::try_upread",
      "ostd::sync::rwlock::RwLock::<T, G>::as_ptr",
      "ostd::<sync::rwlock::RwLock<T, G> as core::fmt::Debug>::fmt"
    ],
    "write": [
      "ostd::sync::rwlock::RwLock::<T, G>::get_mut"
    ],
    "other": []
  },
  "access_self_as_locals": {
    "read": [
      "ostd::irq::top_half::IrqLine::on_active",
      "ostd::<irq::top_half::CallbackHandle as core::ops::Drop>::drop",
      "ostd::irq::top_half::process",
      "ostd::sync::rwarc::RwArc::<T>::read",
      "ostd::sync::rwarc::RwArc::<T>::write",
      "ostd::sync::rwarc::RwArc::<T>::get",
      "ostd::sync::rwarc::RoArc::<T>::read",
      "ostd::<sync::rwlock::RwLockReadGuard<'_, T, G> as core::ops::Deref>::deref",
      "ostd::<sync::rwlock::RwLockReadGuard<'_, T, G> as core::ops::Drop>::drop",
      "ostd::<sync::rwlock::RwLockWriteGuard<'_, T, G> as core::ops::Deref>::deref",
      "ostd::<sync::rwlock::RwLockWriteGuard<'_, T, G> as core::ops::DerefMut>::deref_mut",
      "ostd::<sync::rwlock::RwLockWriteGuard<'_, T, G> as core::ops::Drop>::drop",
      "ostd::sync::rwlock::RwLockUpgradeableGuard::<'a, T, G>::upgrade",
      "ostd::sync::rwlock::RwLockUpgradeableGuard::<'a, T, G>::try_upgrade",
      "ostd::<sync::rwlock::RwLockUpgradeableGuard<'_, T, G> as core::ops::Deref>::deref",
      "ostd::<sync::rwlock::RwLockUpgradeableGuard<'_, T, G> as core::ops::Drop>::drop"
    ],
    "write": [],
    "other": [
      "ostd::irq::top_half::Inner::new",
      "ostd::sync::rwarc::RwArc::<T>::new",
      "ostd::sync::rwlock::RwLock::<T, G>::new"
    ]
  },
  "access_field": [
    {
      "read": [],
      "write": [],
      "other": []
    },
    {
      "read": [
        "ostd::sync::rwlock::RwLock::<T, G>::try_read",
        "ostd::sync::rwlock::RwLock::<T, G>::try_write",
        "ostd::sync::rwlock::RwLock::<T, G>::try_upread",
        "ostd::<sync::rwlock::RwLockReadGuard<'_, T, G> as core::ops::Drop>::drop",
        "ostd::<sync::rwlock::RwLockWriteGuard<'_, T, G> as core::ops::Drop>::drop",
        "ostd::sync::rwlock::RwLockUpgradeableGuard::<'a, T, G>::upgrade",
        "ostd::sync::rwlock::RwLockUpgradeableGuard::<'a, T, G>::try_upgrade",
        "ostd::<sync::rwlock::RwLockUpgradeableGuard<'_, T, G> as core::ops::Drop>::drop"
      ],
      "write": [],
      "other": []
    },
    {
      "read": [
        "ostd::sync::rwlock::RwLock::<T, G>::as_ptr",
        "ostd::<sync::rwlock::RwLock<T, G> as core::fmt::Debug>::fmt",
        "ostd::<sync::rwlock::RwLockReadGuard<'_, T, G> as core::ops::Deref>::deref",
        "ostd::<sync::rwlock::RwLockWriteGuard<'_, T, G> as core::ops::Deref>::deref",
        "ostd::<sync::rwlock::RwLockWriteGuard<'_, T, G> as core::ops::DerefMut>::deref_mut",
        "ostd::<sync::rwlock::RwLockUpgradeableGuard<'_, T, G> as core::ops::Deref>::deref"
      ],
      "write": [
        "ostd::sync::rwlock::RwLock::<T, G>::get_mut"
      ],
      "other": []
    }
  ],
  "span": "ostd/src/sync/rwlock.rs:98:1: 98:54",
  "src": "pub struct RwLock<T: ?Sized, Guard = PreemptDisabled>",
  "kind": "Struct",
  "doc_adt": " Spin-based Read-write Lock\n\n # Overview\n\n This lock allows for multiple readers, or at most one writer to access\n at any point in time. The writer of this lock has exclusive access to\n modify the underlying data, while the readers are allowed shared and\n read-only access.\n\n The writing and reading portions cannot be active simultaneously, when\n one portion is in progress, the other portion will spin-wait. This is\n suitable for scenarios where the lock is expected to be held for short\n periods of time, and the overhead of context switching is higher than\n the cost of spinning.\n\n In addition to traditional read and write locks, this implementation\n provides the upgradeable read lock (`upread lock`). The `upread lock`\n can be upgraded to write locks atomically, useful in scenarios\n where a decision to write is made after reading.\n\n The type parameter `T` represents the data that this lock is protecting.\n It is necessary for `T` to satisfy [`Send`] to be shared across tasks and\n [`Sync`] to permit concurrent access via readers. The [`Deref`] method (and\n [`DerefMut`] for the writer) is implemented for the RAII guards returned\n by the locking methods, which allows for the access to the protected data\n while the lock is held.\n\n # Usage\n The lock can be used in scenarios where data needs to be read frequently\n but written to occasionally.\n\n Use `upread lock` in scenarios where related checking is performed before\n modification to effectively avoid deadlocks and improve efficiency.\n\n This lock should not be used in scenarios where lock-holding times are\n long as it can lead to CPU resource wastage due to spinning.\n\n # About Guard\n\n See the comments of [`SpinLock`].\n\n # Examples\n\n ```\n use ostd::sync::RwLock;\n\n let lock = RwLock::new(5)\n\n // many read locks can be held at once\n {\n     let r1 = lock.read();\n     let r2 = lock.read();\n     assert_eq!(*r1, 5);\n     assert_eq!(*r2, 5);\n     \n     // Upgradeable read lock can share access to data with read locks\n     let r3 = lock.upread();\n     assert_eq!(*r3, 5);\n     drop(r1);\n     drop(r2);\n     // read locks are dropped at this point\n\n     // An upread lock can only be upgraded successfully after all the\n     // read locks are released, otherwise it will spin-wait.\n     let mut w1 = r3.upgrade();\n     *w1 += 1;\n     assert_eq!(*w1, 6);\n }   // upread lock are dropped at this point\n\n {   \n     // Only one write lock can be held at a time\n     let mut w2 = lock.write();\n     *w2 += 1;\n     assert_eq!(*w2, 7);\n }   // write lock is dropped at this point\n ```\n\n [`SpinLock`]: super::SpinLock\n",
  "variant_fields": {
    "VariantIdx(None)-FieldIdx(Some(0))": {
      "name": "guard",
      "doc": ""
    },
    "VariantIdx(None)-FieldIdx(Some(1))": {
      "name": "lock",
      "doc": " The internal representation of the lock state is as follows:\n - **Bit 63:** Writer lock.\n - **Bit 62:** Upgradeable reader lock.\n - **Bit 61:** Indicates if an upgradeable reader is being upgraded.\n - **Bits 60-0:** Reader lock count.\n"
    },
    "VariantIdx(None)-FieldIdx(Some(2))": {
      "name": "val",
      "doc": ""
    }
  }
}