{
  "name": "ostd::boot::smp::ap_early_entry",
  "span": "ostd/src/boot/smp.rs:137:1: 137:65",
  "src": "pub(crate) unsafe extern \"C\" fn ap_early_entry(cpu_id: u32) -> ! {\n    // SAFETY:\n    // 1. We're in the boot context of an AP.\n    // 2. The CPU ID of the AP is correct.\n    unsafe { crate::cpu::init_on_ap(cpu_id) };\n\n    crate::arch::enable_cpu_features();\n\n    // SAFETY: This is called only once on this AP in the boot context.\n    unsafe { crate::arch::trap::init_on_cpu() };\n\n    // SAFETY: This function is only called once on this AP.\n    unsafe { crate::mm::kspace::activate_kernel_page_table() };\n\n    // SAFETY: This function is only called once on this AP, after the BSP has\n    // done the architecture-specific initialization.\n    unsafe { crate::arch::init_on_ap() };\n\n    crate::arch::irq::enable_local();\n\n    // SAFETY:\n    // 1. The kernel page table is activated on this AP.\n    // 2. The function is called only once on this AP.\n    // 3. No remaining `with_borrow` invocations on this CPU from now on.\n    unsafe { crate::mm::page_table::boot_pt::dismiss() };\n\n    log::info!(\"Processor {} started. Spinning for tasks.\", cpu_id);\n\n    // Mark the AP as started. The BSP will resume execution once all the APs\n    // have been marked as such.\n    //\n    // From here to the following `tlb_flush_all_excluding_global`, there is no\n    // TLB coherence because the BSP may not be able to send IPIs to flush the\n    // TLBs. Do not perform complex operations during this period.\n    report_online_and_hw_cpu_id(cpu_id);\n    let ap_late_entry = AP_LATE_ENTRY.wait();\n    crate::arch::mm::tlb_flush_all_excluding_global();\n\n    ap_late_entry();\n\n    Task::yield_now();\n    unreachable!(\"`yield_now` in the boot context should not return\");\n}"
}