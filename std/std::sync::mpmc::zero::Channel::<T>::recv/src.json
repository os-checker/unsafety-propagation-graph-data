{
  "name": "std::sync::mpmc::zero::Channel::<T>::recv",
  "span": "$library/std/src/sync/mpmc/zero.rs:235:5: 235:88",
  "src": "pub(crate) fn recv(&self, deadline: Option<Instant>) -> Result<T, RecvTimeoutError> {\n        let token = &mut Token::default();\n        let mut inner = self.inner.lock().unwrap();\n\n        // If there's a waiting sender, pair up with it.\n        if let Some(operation) = inner.senders.try_select() {\n            token.zero.0 = operation.packet;\n            drop(inner);\n            unsafe {\n                return self.read(token).map_err(|_| RecvTimeoutError::Disconnected);\n            }\n        }\n\n        if inner.is_disconnected {\n            return Err(RecvTimeoutError::Disconnected);\n        }\n\n        Context::with(|cx| {\n            // Prepare for blocking until a sender wakes us up.\n            let oper = Operation::hook(token);\n            let mut packet = Packet::<T>::empty_on_stack();\n            inner.receivers.register_with_packet(oper, (&raw mut packet) as *mut (), cx);\n            inner.senders.notify();\n            drop(inner);\n\n            // Block the current thread.\n            // SAFETY: the context belongs to the current thread.\n            let sel = unsafe { cx.wait_until(deadline) };\n\n            match sel {\n                Selected::Waiting => unreachable!(),\n                Selected::Aborted => {\n                    self.inner.lock().unwrap().receivers.unregister(oper).unwrap();\n                    Err(RecvTimeoutError::Timeout)\n                }\n                Selected::Disconnected => {\n                    self.inner.lock().unwrap().receivers.unregister(oper).unwrap();\n                    Err(RecvTimeoutError::Disconnected)\n                }\n                Selected::Operation(_) => {\n                    // Wait until the message is provided, then read it.\n                    packet.wait_ready();\n                    unsafe { Ok(packet.msg.get().replace(None).unwrap()) }\n                }\n            }\n        })\n    }"
}