{
  "name": "std::sys::thread::unix::cgroups::quota_v2",
  "span": "$library/std/src/sys/thread/unix.rs:705:5: 705:46",
  "src": "fn quota_v2(group_path: PathBuf) -> usize {\n        let mut quota = usize::MAX;\n\n        let mut path = PathBuf::with_capacity(128);\n        let mut read_buf = String::with_capacity(20);\n\n        // standard mount location defined in file-hierarchy(7) manpage\n        let cgroup_mount = \"/sys/fs/cgroup\";\n\n        path.push(cgroup_mount);\n        path.push(&group_path);\n\n        path.push(\"cgroup.controllers\");\n\n        // skip if we're not looking at cgroup2\n        if matches!(exists(&path), Err(_) | Ok(false)) {\n            return usize::MAX;\n        };\n\n        path.pop();\n\n        let _: Option<()> = try {\n            while path.starts_with(cgroup_mount) {\n                path.push(\"cpu.max\");\n\n                read_buf.clear();\n\n                if File::open(&path).and_then(|mut f| f.read_to_string(&mut read_buf)).is_ok() {\n                    let raw_quota = read_buf.lines().next()?;\n                    let mut raw_quota = raw_quota.split(' ');\n                    let limit = raw_quota.next()?;\n                    let period = raw_quota.next()?;\n                    match (limit.parse::<usize>(), period.parse::<usize>()) {\n                        (Ok(limit), Ok(period)) if period > 0 => {\n                            quota = quota.min(limit / period);\n                        }\n                        _ => {}\n                    }\n                }\n\n                path.pop(); // pop filename\n                path.pop(); // pop dir\n            }\n        };\n\n        quota\n    }"
}