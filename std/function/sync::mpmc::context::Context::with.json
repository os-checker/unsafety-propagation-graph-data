{
  "name": "sync::mpmc::context::Context::with",
  "safe": true,
  "callees": {
    "thread::local::LocalKey::<T>::try_with": {
      "safe": true,
      "tags": {
        "tags": [],
        "spec": {},
        "docs": []
      },
      "doc": " Acquires a reference to the value in this TLS key.\n\n This will lazily initialize the value if this thread has not referenced\n this key yet. If the key has been destroyed (which may happen if this is called\n in a destructor), this function will return an [`AccessError`].\n\n # Panics\n\n This function will still `panic!()` if the key is uninitialized and the\n key's initializer panics.\n\n # Examples\n\n ```\n thread_local! {\n     pub static STATIC: String = String::from(\"I am\");\n }\n\n assert_eq!(\n     STATIC.try_with(|original_value| format!(\"{original_value} initialized\")),\n     Ok(String::from(\"I am initialized\")),\n );\n ```\n",
      "adt": {
        "thread::local::LocalKey": "ImmutableAsArgument",
        "core::result::Result": "Constructor"
      }
    },
    "core::result::Result::<T, E>::unwrap_or_else": {
      "safe": true,
      "tags": {
        "tags": [],
        "spec": {},
        "docs": []
      },
      "doc": " Returns the contained [`Ok`] value or computes it from a closure.\n\n\n # Examples\n\n ```\n fn count(x: &str) -> usize { x.len() }\n\n assert_eq!(Ok(2).unwrap_or_else(count), 2);\n assert_eq!(Err(\"foo\").unwrap_or_else(count), 3);\n ```\n",
      "adt": {}
    }
  },
  "adts": {
    "core::option::Option": [
      "Plain",
      "MutRef"
    ],
    "thread::local::LocalKey": [
      "Ref"
    ],
    "core::result::Result": [
      "Plain"
    ]
  },
  "path": 2813,
  "span": "/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:37:5: 63:6",
  "src": "pub fn with<F, R>(f: F) -> R\n    where\n        F: FnOnce(&Context) -> R,\n    {\n        thread_local! {\n            /// Cached thread-local context.\n            static CONTEXT: Cell<Option<Context>> = Cell::new(Some(Context::new()));\n        }\n\n        let mut f = Some(f);\n        let mut f = |cx: &Context| -> R {\n            let f = f.take().unwrap();\n            f(cx)\n        };\n\n        CONTEXT\n            .try_with(|cell| match cell.take() {\n                None => f(&Context::new()),\n                Some(cx) => {\n                    cx.reset();\n                    let res = f(&cx);\n                    cell.set(Some(cx));\n                    res\n                }\n            })\n            .unwrap_or_else(|_| f(&Context::new()))\n    }",
  "mir": "fn sync::mpmc::context::Context::with(_1: F) -> R {\n    let mut _0: R;\n    let mut _2: core::option::Option<F>;\n    let mut _3: {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:47:21: 47:40};\n    let mut _4: &mut core::option::Option<F>;\n    let mut _5: core::result::Result<R, thread::local::AccessError>;\n    let mut _6: &thread::local::LocalKey<core::cell::Cell<core::option::Option<sync::mpmc::context::Context>>>;\n    let mut _7: {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:53:23: 53:29};\n    let mut _8: &mut {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:47:21: 47:40};\n    let mut _9: {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:62:29: 62:32};\n    let mut _10: &mut {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:47:21: 47:40};\n    debug f => _1;\n    debug f => _2;\n    debug f => _3;\n    bb0: {\n        StorageLive(_2);\n        _2 = core::option::Option::Some(_1);\n        StorageLive(_3);\n        StorageLive(_4);\n        _4 = &mut _2;\n        _3 = {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:47:21: 47:40}(move _4);\n        StorageDead(_4);\n        StorageLive(_5);\n        StorageLive(_6);\n        _6 = sync::mpmc::context::Context::with::<F, R>::promoted[0];\n        StorageLive(_7);\n        StorageLive(_8);\n        _8 = &mut _3;\n        _7 = {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:53:23: 53:29}(move _8);\n        StorageDead(_8);\n        _5 = thread::local::LocalKey::<core::cell::Cell<core::option::Option<sync::mpmc::context::Context>>>::try_with::<{closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:53:23: 53:29}, R>(move _6, move _7) -> [return: bb1, unwind unreachable];\n    }\n    bb1: {\n        StorageDead(_7);\n        StorageDead(_6);\n        StorageLive(_9);\n        StorageLive(_10);\n        _10 = &mut _3;\n        _9 = {closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:62:29: 62:32}(move _10);\n        StorageDead(_10);\n        _0 = core::result::Result::<R, thread::local::AccessError>::unwrap_or_else::<{closure@/home/gh-zjp-CN/.rustup/toolchains/nightly-2025-12-06-aarch64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sync/mpmc/context.rs:62:29: 62:32}>(move _5, move _9) -> [return: bb2, unwind unreachable];\n    }\n    bb2: {\n        StorageDead(_9);\n        StorageDead(_5);\n        StorageDead(_3);\n        drop(_2) -> [return: bb3, unwind unreachable];\n    }\n    bb3: {\n        StorageDead(_2);\n        return;\n    }\n}\n",
  "doc": " Creates a new context for the duration of the closure.\n",
  "tags": {
    "tags": [],
    "spec": {},
    "docs": []
  }
}