{
  "name": "std::sys::net::connection::socket::unix::Socket::new",
  "span": "$library/std/src/sys/net/connection/socket/unix.rs:66:5: 66:63",
  "src": "pub fn new(family: c_int, ty: c_int) -> io::Result<Socket> {\n        cfg_select! {\n            any(\n                target_os = \"android\",\n                target_os = \"dragonfly\",\n                target_os = \"freebsd\",\n                target_os = \"illumos\",\n                target_os = \"hurd\",\n                target_os = \"linux\",\n                target_os = \"netbsd\",\n                target_os = \"openbsd\",\n                target_os = \"cygwin\",\n                target_os = \"nto\",\n                target_os = \"solaris\",\n            ) => {\n                // On platforms that support it we pass the SOCK_CLOEXEC\n                // flag to atomically create the socket and set it as\n                // CLOEXEC. On Linux this was added in 2.6.27.\n                let fd = cvt(unsafe { libc::socket(family, ty | libc::SOCK_CLOEXEC, 0) })?;\n                let socket = Socket(unsafe { FileDesc::from_raw_fd(fd) });\n\n                // DragonFlyBSD, FreeBSD and NetBSD use `SO_NOSIGPIPE` as a `setsockopt`\n                // flag to disable `SIGPIPE` emission on socket.\n                #[cfg(any(target_os = \"freebsd\", target_os = \"netbsd\", target_os = \"dragonfly\"))]\n                unsafe { setsockopt(&socket, libc::SOL_SOCKET, libc::SO_NOSIGPIPE, 1)? };\n\n                Ok(socket)\n            }\n            _ => {\n                let fd = cvt(unsafe { libc::socket(family, ty, 0) })?;\n                let fd = unsafe { FileDesc::from_raw_fd(fd) };\n                fd.set_cloexec()?;\n                let socket = Socket(fd);\n\n                // macOS and iOS use `SO_NOSIGPIPE` as a `setsockopt`\n                // flag to disable `SIGPIPE` emission on socket.\n                #[cfg(target_vendor = \"apple\")]\n                unsafe { setsockopt(&socket, libc::SOL_SOCKET, libc::SO_NOSIGPIPE, 1)? };\n\n                Ok(socket)\n            }\n        }\n    }"
}