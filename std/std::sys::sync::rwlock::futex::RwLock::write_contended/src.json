{
  "name": "std::sys::sync::rwlock::futex::RwLock::write_contended",
  "span": "$library/std/src/sys/sync/rwlock/futex.rs:209:5: 209:30",
  "src": "fn write_contended(&self) {\n        let mut state = self.spin_write();\n\n        let mut other_writers_waiting = 0;\n\n        loop {\n            // If it's unlocked, we try to lock it.\n            if is_unlocked(state) {\n                match self.state.compare_exchange_weak(\n                    state,\n                    state | WRITE_LOCKED | other_writers_waiting,\n                    Acquire,\n                    Relaxed,\n                ) {\n                    Ok(_) => return, // Locked!\n                    Err(s) => {\n                        state = s;\n                        continue;\n                    }\n                }\n            }\n\n            // Set the waiting bit indicating that we're waiting on it.\n            if !has_writers_waiting(state) {\n                if let Err(s) =\n                    self.state.compare_exchange(state, state | WRITERS_WAITING, Relaxed, Relaxed)\n                {\n                    state = s;\n                    continue;\n                }\n            }\n\n            // Other writers might be waiting now too, so we should make sure\n            // we keep that bit on once we manage lock it.\n            other_writers_waiting = WRITERS_WAITING;\n\n            // Examine the notification counter before we check if `state` has changed,\n            // to make sure we don't miss any notifications.\n            let seq = self.writer_notify.load(Acquire);\n\n            // Don't go to sleep if the lock has become available,\n            // or if the writers waiting bit is no longer set.\n            state = self.state.load(Relaxed);\n            if is_unlocked(state) || !has_writers_waiting(state) {\n                continue;\n            }\n\n            // Wait for the state to change.\n            futex_wait(&self.writer_notify, seq, None);\n\n            // Spin again after waking up.\n            state = self.spin_write();\n        }\n    }"
}