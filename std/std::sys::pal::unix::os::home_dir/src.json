{
  "name": "std::sys::pal::unix::os::home_dir",
  "span": "$library/std/src/sys/pal/unix/os.rs:610:1: 610:37",
  "src": "pub fn home_dir() -> Option<PathBuf> {\n    return crate::env::var_os(\"HOME\")\n        .filter(|s| !s.is_empty())\n        .or_else(|| unsafe { fallback() })\n        .map(PathBuf::from);\n\n    #[cfg(any(\n        target_os = \"android\",\n        target_os = \"emscripten\",\n        target_os = \"redox\",\n        target_os = \"vxworks\",\n        target_os = \"espidf\",\n        target_os = \"horizon\",\n        target_os = \"vita\",\n        target_os = \"nuttx\",\n        all(target_vendor = \"apple\", not(target_os = \"macos\")),\n    ))]\n    unsafe fn fallback() -> Option<OsString> {\n        None\n    }\n    #[cfg(not(any(\n        target_os = \"android\",\n        target_os = \"emscripten\",\n        target_os = \"redox\",\n        target_os = \"vxworks\",\n        target_os = \"espidf\",\n        target_os = \"horizon\",\n        target_os = \"vita\",\n        target_os = \"nuttx\",\n        all(target_vendor = \"apple\", not(target_os = \"macos\")),\n    )))]\n    unsafe fn fallback() -> Option<OsString> {\n        let amt = match libc::sysconf(libc::_SC_GETPW_R_SIZE_MAX) {\n            n if n < 0 => 512 as usize,\n            n => n as usize,\n        };\n        let mut buf = Vec::with_capacity(amt);\n        let mut p = mem::MaybeUninit::<libc::passwd>::uninit();\n        let mut result = ptr::null_mut();\n        match libc::getpwuid_r(\n            libc::getuid(),\n            p.as_mut_ptr(),\n            buf.as_mut_ptr(),\n            buf.capacity(),\n            &mut result,\n        ) {\n            0 if !result.is_null() => {\n                let ptr = (*result).pw_dir as *const _;\n                let bytes = CStr::from_ptr(ptr).to_bytes().to_vec();\n                Some(OsStringExt::from_vec(bytes))\n            }\n            _ => None,\n        }\n    }\n}"
}