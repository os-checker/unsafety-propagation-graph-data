{
  "name": "std::thread::spawnhook::add_spawn_hook",
  "span": "$library/std/src/thread/spawnhook.rs:92:1: 95:34",
  "doc": " Registers a function to run for every newly thread spawned.\n\n The hook is executed in the parent thread, and returns a function\n that will be executed in the new thread.\n\n The hook is called with the `Thread` handle for the new thread.\n\n The hook will only be added for the current thread and is inherited by the threads it spawns.\n In other words, adding a hook has no effect on already running threads (other than the current\n thread) and the threads they might spawn in the future.\n\n Hooks can only be added, not removed.\n\n The hooks will run in reverse order, starting with the most recently added.\n\n # Usage\n\n ```\n #![feature(thread_spawn_hook)]\n\n std::thread::add_spawn_hook(|_| {\n     ..; // This will run in the parent (spawning) thread.\n     move || {\n         ..; // This will run it the child (spawned) thread.\n     }\n });\n ```\n\n # Example\n\n A spawn hook can be used to \"inherit\" a thread local from the parent thread:\n\n ```\n #![feature(thread_spawn_hook)]\n\n use std::cell::Cell;\n\n thread_local! {\n     static X: Cell<u32> = Cell::new(0);\n }\n\n // This needs to be done once in the main thread before spawning any threads.\n std::thread::add_spawn_hook(|_| {\n     // Get the value of X in the spawning thread.\n     let value = X.get();\n     // Set the value of X in the newly spawned thread.\n     move || X.set(value)\n });\n\n X.set(123);\n\n std::thread::spawn(|| {\n     assert_eq!(X.get(), 123);\n }).join().unwrap();\n ```\n"
}