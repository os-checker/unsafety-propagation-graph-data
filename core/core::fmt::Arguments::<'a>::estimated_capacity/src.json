{
  "name": "core::fmt::Arguments::<'a>::estimated_capacity",
  "span": "$library/core/src/fmt/mod.rs:754:5: 754:46",
  "src": "pub fn estimated_capacity(&self) -> usize {\n        if let Some(s) = self.as_str() {\n            return s.len();\n        }\n        // Iterate over the template, counting the length of literal pieces.\n        let mut length = 0usize;\n        let mut starts_with_placeholder = false;\n        let mut template = self.template;\n        loop {\n            // SAFETY: We can assume the template is valid.\n            unsafe {\n                let n = template.read();\n                template = template.add(1);\n                if n == 0 {\n                    // End of template.\n                    break;\n                } else if n < 128 {\n                    // Short literal string piece.\n                    length += n as usize;\n                    template = template.add(n as usize);\n                } else if n == 128 {\n                    // Long literal string piece.\n                    let len = usize::from(u16::from_le_bytes(template.cast_array().read()));\n                    length += len;\n                    template = template.add(2 + len);\n                } else {\n                    assert_unchecked(n >= 0xC0);\n                    // Placeholder piece.\n                    if length == 0 {\n                        starts_with_placeholder = true;\n                    }\n                    // Skip remainder of placeholder:\n                    let skip = (n & 1 != 0) as usize * 4 // flags (32 bit)\n                        + (n & 2 != 0) as usize * 2  // width     (16 bit)\n                        + (n & 4 != 0) as usize * 2  // precision (16 bit)\n                        + (n & 8 != 0) as usize * 2; // arg_index (16 bit)\n                    template = template.add(skip as usize);\n                }\n            }\n        }\n\n        if starts_with_placeholder && length < 16 {\n            // If the format string starts with a placeholder,\n            // don't preallocate anything, unless length\n            // of literal pieces is significant.\n            0\n        } else {\n            // There are some placeholders, so any additional push\n            // will reallocate the string. To avoid that,\n            // we're \"pre-doubling\" the capacity here.\n            length.wrapping_mul(2)\n        }\n    }"
}